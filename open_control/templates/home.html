<!DOCTYPE html>
<html>
<head>
	<title>Flask Graph</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../static/home.css">
    <link rel="icon" href="../static/favicon.ico" />
	<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script type="text/javascript" 
            src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js">
	</script>
</head>
	<body>

		<!-- Sidebar -->
<nav class="w3-sidebar w3-black w3-animate-top w3-xxlarge" style="display:none;padding-top:150px" id="mySidebar">
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-button w3-black w3-xxlarge w3-padding w3-display-topright" style="padding:6px 24px">
    	<i class="fa fa-remove"></i>
  	</a>
 	<div class="w3-bar-block w3-center">
    	<a href="http://127.0.0.1:5000/#" class="w3-bar-item w3-button w3-text-grey w3-hover-black">Home</a>
        <a href="http://127.0.0.1:5000/input_user" class="w3-bar-item w3-button w3-text-grey w3-hover-black">Show The Graph</a>
        <a href="http://192.168.1.50:5000/#" class="w3-bar-item w3-button w3-text-grey w3-hover-black">Details</a>
	</div>
</nav>

<!-- !PAGE CONTENT! -->
<div class="w3-content" style="max-width:1500px">
	<!-- Header -->
<div class="w3-opacity">
<span class="w3-button w3-xxlarge w3-white w3-right" onclick="w3_open()"><i class="fa fa-bars"></i></span>
<div class="w3-clear"></div>
<header class="w31-center w3-margin-bottom">
   
<h1 style="text-align:center;"><b>Chemical Reaction Network simulation tool</b></h1>
<h1 style="text-align:center;"><b>(CoNtRol-Sim)</b></h1>
<div style="width: 60%; left: 21%; padding-top:2%; position: relative">
<!--  <p><b>Apasa pentru a afisa graficul.</b></p>
  <p class="w3-padding-16"><button id="buton" class="w3-button w3-black" onclick="window.location='graph2';">Vezi graficul</button></p>
-->
<div class="content">
Chemical reaction network theory is an area of applied mathematics
 that attempts to model the behavior of real-world chemical systems.
Since its foundation in the 1960s, it has attracted a growing research community,
 mainly due to its applications in biochemistry and theoretical chemistry</div>

<div class="content" style="padding-top:1%">
A chemical reaction network (CRN) comprises a set of reactants, a set of products and a 
set of reactions. For example, the pair of combustion reactions:</div>
<div class="content" style="padding-top:1%">
2H<p style="font-size:9px; display:inline">2</p> + O<p style="font-size:9px; display:inline">2
</p> &rarr; 2H<p style="font-size:9px;display:inline">2</p>O<br>
&nbsp;&nbsp;&nbsp;C + O<p style="font-size:9px; display:inline">2</p> &rarr; CO<p style="font-size:9px; display:inline">2</p>
</div>
</div>

<br>
<div style="text-align: center;">
							<button id="Add" href="#" title="Add new reaction" style="height: 44px; width: 44px;">+</button>
							<button id="Remove" href="#" title="Remove last reaction" style="height: 44px; width: 44px;">–</button> 
							<button id="reset_reaction_button" href="#" title="Reset all reactions" style="height: 44px; width: 44px;">--</button>

{#    TODO tine minte sa incerci sa pui cu url_for('save_reactii') #}
<form action="/save_reactii" id = "DynamicTextBox" class="contact-form" method="post">

                            {{ form.hidden_tag() }}

							<div id="textboxDiv">
                                {% for reaction in form.reactions %}
                                    <div>
                                    {{ reaction.ec_left }}
                                    {% if reaction.ec_left.errors %}
                                        <ul class="errors">
                                            {% for error in reaction.ec_left.errors %}
                                                <li>{{ error }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                    {{ reaction.ec_dir }}
                                    {{ reaction.ec_right }}
                                    {% if reaction.ec_right.errors %}
                                        <ul class="errors">
                                            {% for error in reaction.ec_right.errors %}
                                                <li>{{ error }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                    </div>
                                {% endfor %}
								
							</div>

							<div style="position: relative; left: 21%">
							  <!--<p><b>Creare grafic personalizat.</b></p>-->
							  <p class="w3-padding-16">
                                  {{ form.submit }}
                              </p>
							</div>
</form>

<div class="form-status-holder"></div>

{#    <img src="/static/grafic.svg" alt="my plot" width="150" height="150">#}

</div>

</header>
</div>


<!-- Footer -->
<footer class="w3-container w3-padding-54 w3-light-grey w3-center w3-opacity w3-xlarge" style="/*!margin-top:128px;  margin-left:-20px;*/ position:absolute;/*! bottom:0;*/ width:100%; padding-top:2%; padding-bottom:2%">

  <p class="w3-medium">2023@  <a target="_blank" class="w3-hover-text-green"></a> </p>

</footer>
<script>

var countEcuatii = 0;

function updateFormReactCount(ecuatiiCount)
{
	$("#ecuatiiCount").val(ecuatiiCount);
}

function genTextBox(textBoxID)
{
	$("#textboxDiv").append(`<div>
	                            <br>
                                <input name='ec_${textBoxID}_left' type='text' size='20' maxlength='64' value='' spellcheck='false' placeholder='∅'/>
    							<select name='ec_${textBoxID}_dir' class='reaction_direction' >
         							<option value='left'>&#8592</option>
        							<option value='both' selected='selected'>⇌</option>
        							<option value='right'>&#8594</option>
    							</select>
    							<input name='ec_${textBoxID}_right'  type='text' size='20' maxlength='64' value='' spellcheck='false' placeholder='∅'/>
                            <br></div> `);
}
   // Add textbox and remove textbox
        $(document).ready(() => {
			genTextBox(countEcuatii);
			updateFormReactCount(countEcuatii);

            $("#Add").on("click",() => {
				countEcuatii++;
				genTextBox(countEcuatii);
				updateFormReactCount(countEcuatii);
			} );
            $("#Remove").on("click", () => {
				if (countEcuatii > 0)
				{
					countEcuatii--;
					updateFormReactCount(countEcuatii);
					$("#textboxDiv").children().last().remove();  
				}
            });
			
        });  


	
	var timeoutId;

$('form input, form select').on('input propertychange change', () => {
    console.log('Textarea Change');
    
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => {
        // Runs 1 second (1000 ms) after the last change    
        saveToDB();
    }, 1000);
});

function saveToDB()
{
    console.log('Saving to the db');
	//form = genauto(),
   // form = $('.textboxDiv');
   form = $('.textbox');
  //  form = $('.textbox').each(() => {
  //          form += $(this).val() + "\n";
  //      });   
	$.ajax({
		url: "/echo/html/",
		type: "POST",
		data: form.serialize(), // serializes the form's elements.
		beforeSend: (xhr) => {
            // Let them know we are saving
			$('.form-status-holder').html('Saving...');
		},
		success: (data) => {
			var jqObj = jQuery(data); // You can get data returned from your ajax call here. ex. jqObj.find('.returned-data').html()
            // Now show them we saved and when we did
            var d = new Date();
            $('.form-status-holder').html('Saved! Last: ' + d.toLocaleTimeString());
		},
	});
}

// This is just so we don't go anywhere  
// and still save if you submit the form
// $('.contact-form').submit((e) => {
//	saveToDB();
//	e.preventDefault();
// });




		
		
	
	
// Toggle grid padding
function myFunction() {
  var x = document.getElementById("myGrid");
  if (x.className === "w3-row") {
    x.className = "w3-row-padding";
  } else {
    x.className = x.className.replace("w3-row-padding", "w3-row");
  }
}

// Open and close sidebar
function w3_open() {
  document.getElementById("mySidebar").style.width = "100%";
  document.getElementById("mySidebar").style.display = "block";
}

function w3_close() {
  document.getElementById("mySidebar").style.display = "none";
}





		
</script>

</body>
</html>
